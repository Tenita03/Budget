<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Paycheck Tracker ‚Äì Calm Planner v19</title>

<style>
:root{
  --bg:#f3f4f6;
  --card:#ffffff;
  --soft:#f8fafc;
  --text:#0f172a;
  --muted:#64748b;
  --line:#e5e7eb;
  --brand:#007aff;
  --danger:#fff1f2;
  --warn:#fffbeb;
  --shadow:0 10px 30px rgba(0,0,0,.06);
  --radius:16px;
}

*{ box-sizing:border-box; }

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif;
}

.wrap{
  max-width:1100px;
  margin:auto;
  padding:16px;
  padding-bottom:80px;
}

.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:16px;
  margin-bottom:14px;
}

.soft{ background:var(--soft); }

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}

.topbar .left,
.topbar .right{
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:wrap;
}

select, input{
  font-size:14px;
  padding:8px 10px;
  border-radius:8px;
  background:#f8fafc;
  border:1px solid #e5e7eb;
  width:100%;
}

select:hover, input:hover{
  background:#f1f5f9;
}

select:focus, input:focus{
  outline:none;
  background:#ffffff;
  border-color:rgba(0,122,255,.5);
  box-shadow:0 0 0 3px rgba(0,122,255,.12);
}

select:hover, input:hover{ background:rgba(0,0,0,.04); }
select:focus, input:focus{
  outline:none;
  border-color:rgba(0,122,255,.35);
  background:#fff;
}

.btn{
  border:none;
  border-radius:12px;
  padding:10px 12px;
  font-size:14px;
  cursor:pointer;
  background:var(--brand);
  color:#fff;
}

.btn.secondary{ background:#94a3b8; }
.btn.ghost{
  background:transparent;
  border:1px solid var(--line);
  color:var(--text);
}

.kpi{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.kpi .label{
  color:var(--muted);
  font-weight:600;
}

.kpi .value{
  font-size:34px;
  font-weight:800;
}

.kpi.positive .value{ color:#15803d; }
.kpi.negative .value{ color:#b91c1c; }

.subnote{
  margin-top:8px;
  font-size:13px;
  color:var(--muted);
}

.section-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}

.section-head h2{
  margin:0;
  font-size:18px;
}

.chev{
  border:1px solid var(--line);
  border-radius:10px;
  padding:4px 8px;
}

.section-body{ margin-top:12px; }
.collapsed .section-body{ display:none; }

table{
  width:100%;
  border-collapse:collapse;
}

/* Soft column separators */
tbody td + td{
  border-left:1px solid rgba(226,232,240,.6);
}

thead th + th{
  border-left:1px solid rgba(226,232,240,.6);
}

/* ====== TABLE LAYOUT CONTROL ====== */
table{
  table-layout: fixed;
}

/* Bills table column widths */
#billsCard th:nth-child(1),
#billsCard td:nth-child(1){ width:40px; }

#billsCard th:nth-child(2),
#billsCard td:nth-child(2){ width:22%; }

#billsCard th:nth-child(3),
#billsCard td:nth-child(3){ width:110px; }

#billsCard th:nth-child(4),
#billsCard td:nth-child(4){ width:120px; }

#billsCard th:nth-child(5),
#billsCard td:nth-child(5){ width:160px; }

#billsCard th:nth-child(6),
#billsCard td:nth-child(6){ width:150px; }

#billsCard th:nth-child(7),
#billsCard td:nth-child(7){ width:120px; }

/* Debt table column widths */
#debtCard th:nth-child(1),
#debtCard td:nth-child(1){ width:22%; }

#debtCard th:nth-child(2),
#debtCard td:nth-child(2),
#debtCard th:nth-child(3),
#debtCard td:nth-child(3),
#debtCard th:nth-child(4),
#debtCard td:nth-child(4),
#debtCard th:nth-child(5),
#debtCard td:nth-child(5),
#debtCard th:nth-child(6),
#debtCard td:nth-child(6),
#debtCard th:nth-child(7),
#debtCard td:nth-child(7),
#debtCard th:nth-child(8),
#debtCard td:nth-child(8){
  width:110px;
}

thead th{
  font-size:12px;
  color:var(--muted);
  text-align:left;
  padding:8px;
  border-bottom:1px solid var(--line);
}

tbody td{
  padding:8px;
  border-bottom:1px solid var(--line);
}

.right{ text-align:right; }
.cell-tight{ width:1%; white-space:nowrap; }

.remove{
  font-size:18px;
  cursor:pointer;
  color:#94a3b8;
}

.remove:hover{ color:#ef4444; }

.group-row td{
  font-size:12px;
  color:var(--muted);
  font-weight:700;
  padding-top:14px;
  border-bottom:none;
}

.bill-paid{ opacity:.4; }
.bill-overdue{ background:var(--danger); }
.bill-today{ background:var(--warn); }

.totalbar{
  display:flex;
  justify-content:flex-end;
  gap:20px;
  margin-top:10px;
  font-size:13px;
  color:var(--muted);
}

.overview{
  display:grid;
  grid-template-columns:1fr auto;
  gap:10px 16px;
}

.overview .k{ color:var(--muted); font-weight:600; }
.overview .v{ font-weight:800; text-align:right; }

.locked input,
.locked select,
.locked button,
.locked .remove{
  pointer-events:none;
  opacity:.6;
}

@media (max-width: 480px){
  input, select, button{
    min-height:44px;
    font-size:15px;
  }
}

.focus-hide{ display:none !important; }

/* =========================
   iPHONE OPTIMIZATION
========================= */
@media (max-width: 480px){

  /* Kill horizontal scroll globally */
  body{
    overflow-x:hidden;
  }

  table, thead, tbody, th, td, tr{
    display:block;
    width:100%;
  }

  thead{
    display:none;
  }

  tbody tr{
    margin-bottom:12px;
    padding:10px;
    background:#f8fafc;
    border-radius:12px;
    border:1px solid #e5e7eb;
  }

  tbody td{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    padding:6px 0;
    border:none;
  }

  tbody td::before{
    content:attr(data-label);
    font-size:12px;
    color:#64748b;
    font-weight:600;
    flex:1;
  }

  tbody td input,
  tbody td select{
    flex:1;
    max-width:55%;
  }

  .remove{
    font-size:20px;
    margin-left:8px;
  }

  /* KPI spacing */
  .kpi .value{
    font-size:28px;
  }

  /* Section spacing */
  .section-body{
    margin-top:8px;
  }
}

/* =========================
   iPhone 13 Pro Max
   Portrait-only tuning
========================= */
@media (max-width: 430px) and (orientation: portrait){

  /* Overall layout */
  .wrap{
    padding:12px;
  }

  .card{
    padding:14px;
    border-radius:18px;
  }

  /* Remaining KPI (top priority) */
  .kpi{
    align-items:flex-start;
    gap:6px;
  }

  .kpi .label{
    font-size:14px;
  }

  .kpi .value{
    font-size:30px;
    letter-spacing:-0.4px;
  }

  /* Section headers */
  .section-head h2{
    font-size:17px;
  }

  .chev{
    padding:6px 10px;
    border-radius:12px;
  }

  /* ===== TABLE ‚Üí STACKED CARD TRANSFORM ===== */
  table, thead, tbody, th, td, tr{
    display:block;
    width:100%;
  }

  thead{
    display:none;
  }

  tbody tr{
    background:#ffffff;
    border:1px solid #e5e7eb;
    border-radius:16px;
    padding:10px 12px;
    margin-bottom:14px;
    box-shadow:0 6px 14px rgba(0,0,0,.04);
  }

  tbody td{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding:6px 0;
    border:none;
  }

  /* Label (left) */
  tbody td::before{
    content:attr(data-label);
    font-size:12px;
    font-weight:600;
    color:#64748b;
    flex:1;
  }

  /* Value / input (right) */
  tbody td input,
  tbody td select,
  tbody td span{
    flex:1;
    max-width:58%;
    text-align:right;
  }

  /* Paid / checkbox alignment */
  tbody td input[type="checkbox"]{
    max-width:none;
    transform:scale(1.25);
  }

  /* Remove (X) button */
  .remove{
    font-size:22px;
    padding-left:6px;
  }

  /* Bills visual states */
  .bill-paid{
    opacity:.45;
  }

  .bill-overdue{
    background:#fff1f2;
    border-color:#fecdd3;
  }

  .bill-today{
    background:#fffbeb;
    border-color:#fde68a;
  }

  /* Debt meta text spacing */
  .debt-meta{
    margin-top:4px;
    font-size:12px;
  }

  .time-killed{
    margin-top:2px;
    font-size:12px;
  }

  /* Touch comfort */
  input, select, button{
    min-height:44px;
    font-size:15px;
  }

  button{
    border-radius:14px;
  }

  /* Hide column separators (not needed on mobile) */
  thead th + th,
  tbody td + td{
    border-left:none;
  }
}

</style>
</head>

<body>
<div class="wrap" id="app">

  <!-- HEADER -->
  <section class="card">
    <div class="topbar">
      <div class="left">
        <select id="monthSel"></select>
        <select id="yearSel"></select>
        <span>
          Starting Balance $
          <input id="startingBalance" type="number" value="0" style="width:120px;text-align:right;">
        </span>
      </div>
      <div class="right">
        <button class="btn ghost" id="focusBtn">üéØ Debt Focus</button>
        <button class="btn secondary" id="printBtn">üñ®Ô∏è Print</button>
        <button class="btn secondary" id="lockBtn">üîì Lock Month</button>
      </div>
    </div>
    <div class="subnote" id="lockNote"></div>
  </section>

  <!-- REMAINING -->
  <section class="card">
    <div class="kpi" id="remainingKpi">
      <div class="label">Remaining This Month</div>
      <div class="value" id="remainingAmt">$0.00</div>
    </div>
    <div class="subnote" id="statusMsg">Ready.</div>
  </section>

  <!-- INCOME -->
  <section class="card" id="incomeCard">
    <div class="section-head">
      <h2>Income</h2>
      <span class="chev">‚åÑ</span>
    </div>
    <div class="section-body">
      <table>
        <thead><tr><th>Date</th><th>Source</th><th class="right">Amount</th><th></th></tr></thead>
        <tbody id="incomeTable"></tbody>
      </table>
      <button class="btn" id="addIncomeBtn">+ Add Income</button>
    </div>
  </section>

  <!-- SAVINGS -->
  <section class="card soft" id="savingsCard">
    <div class="section-head">
      <h2>Monthly Savings</h2>
      <span class="chev">‚åÑ</span>
    </div>
    <div class="section-body">
      <table>
        <thead><tr><th>Purpose</th><th class="right">Amount</th><th></th></tr></thead>
        <tbody id="savingsTable"></tbody>
      </table>
      <button class="btn" id="addSavingsBtn">+ Add Savings</button>
    </div>
  </section>

  <!-- BILLS -->
  <section class="card" id="billsCard">
    <div class="section-head">
      <h2>Bills</h2>
      <span class="chev">‚åÑ</span>
    </div>
    <div class="section-body">
      <table>
        <thead>
          <tr>
            <th>‚úî</th>
            <th>Bill</th>
            <th>Due</th>
            <th class="right">Amount</th>
            <th>Linked Debt</th>
            <th>Type</th>
            <th class="right">Remaining</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="billsTable"></tbody>
      </table>
      <button class="btn" id="addBillBtn">+ Add Bill</button>
    </div>
  </section>

  <!-- DEBT -->
  <section class="card" id="debtCard">
    <div class="section-head">
      <h2>Debt</h2>
      <span class="chev">‚åÑ</span>
    </div>
    <div class="section-body">
      <table>
        <thead>
          <tr>
            <th>Debt</th>
            <th class="right">Balance</th>
            <th class="right">APR %</th>
            <th class="right">Payment</th>
            <th class="right">Extra</th>
            <th class="right">Interest</th>
            <th class="right">Principal</th>
            <th class="right">New Balance</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="debtTable"></tbody>
      </table>
      <button class="btn" id="addDebtBtn">+ Add Debt</button>
    </div>
  </section>

  <!-- OVERVIEW -->
  <section class="card">
    <h2>Monthly Overview</h2>
    <div class="overview">
      <div class="k">Opening Balance</div><div class="v" id="oStart">$0.00</div>
      <div class="k">Income</div><div class="v" id="oIncome">$0.00</div>
      <div class="k">Bills</div><div class="v" id="oBills">$0.00</div>
      <div class="k">Debt</div><div class="v" id="oDebt">$0.00</div>
      <div class="k">Savings</div><div class="v" id="oSavings">$0.00</div>
      <div class="k">Balance Forward</div><div class="v" id="oForward">$0.00</div>
    </div>
  </section>

</div>

<!-- PART 2 (JavaScript) WILL GO BELOW THIS LINE -->

<script>
/* =========================
   Paycheck Tracker v19
   Calm Planner Engine
========================= */

const $ = id => document.getElementById(id);
const app = $("app");

const monthSel = $("monthSel");
const yearSel  = $("yearSel");
const startingBalance = $("startingBalance");

const incomeTable  = $("incomeTable");
const savingsTable = $("savingsTable");
const billsTable   = $("billsTable");
const debtTable    = $("debtTable");

const addIncomeBtn  = $("addIncomeBtn");
const addSavingsBtn = $("addSavingsBtn");
const addBillBtn    = $("addBillBtn");
const addDebtBtn    = $("addDebtBtn");

const remainingAmt = $("remainingAmt");
const remainingKpi = $("remainingKpi");
const statusMsg    = $("statusMsg");

const lockBtn  = $("lockBtn");
const lockNote = $("lockNote");
const focusBtn = $("focusBtn");
const printBtn = $("printBtn");

const oStart   = $("oStart");
const oIncome  = $("oIncome");
const oBills   = $("oBills");
const oDebt    = $("oDebt");
const oSavings = $("oSavings");
const oForward = $("oForward");

let locked = false;
let debtFocus = false;

/* -------------------------
   Helpers
------------------------- */
const num = v => Number(v) || 0;
const money = v => `$${num(v).toFixed(2)}`;

function uid(){
  return Date.now().toString(36) + Math.random().toString(36).slice(2,7);
}

function storageKey(){
  return `planner-v19-${yearSel.value}-${monthSel.value}`;
}

/* -------------------------
   Month / Year
------------------------- */
(function initMonthYear(){
  const now = new Date();
  for(let i=0;i<12;i++){
    const o=document.createElement("option");
    o.value=i;
    o.textContent=new Date(0,i).toLocaleString("default",{month:"long"});
    monthSel.appendChild(o);
  }
  for(let y=2024;y<2036;y++){
    const o=document.createElement("option");
    o.value=y;
    o.textContent=y;
    yearSel.appendChild(o);
  }
  monthSel.value=now.getMonth();
  yearSel.value=now.getFullYear();
})();

/* -------------------------
   Collapsible sections
------------------------- */
document.querySelectorAll(".section-head").forEach(head=>{
  head.onclick=()=>{
    if(locked) return;
    const card=head.closest(".card");
    card.classList.toggle("collapsed");
    saveAll();
  };
});

/* -------------------------
   Lock month
------------------------- */
lockBtn.onclick=()=>{
  locked=!locked;
  app.classList.toggle("locked",locked);
  lockBtn.textContent=locked?"üîí Unlock":"üîì Lock Month";
  lockNote.textContent=locked?"This month is locked to preserve history.":"";
  statusMsg.textContent=locked?"Month locked.":"Month unlocked.";
  saveAll();
};

/* -------------------------
   Debt focus
------------------------- */
focusBtn.onclick=()=>{
  debtFocus=!debtFocus;
  ["incomeCard","savingsCard"].forEach(id=>{
    $(id).classList.toggle("focus-hide",debtFocus);
  });
  focusBtn.textContent=debtFocus?"üß≠ Exit Focus":"üéØ Debt Focus";
};

/* -------------------------
   Row builders
------------------------- */
function addRemove(td,row){
  td.innerHTML="√ó";
  td.className="remove";
  td.onclick=()=>{
    if(locked) return;
    row.remove();
    updateAll();
  };
}

function addIncomeRow(data={}){
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td><input type="date" value="${data.date||""}"></td>
    <td><input value="${data.source||""}"></td>
    <td class="right"><input type="number" value="${data.amount||0}"></td>
    <td class="cell-tight"></td>`;
  addRemove(tr.lastElementChild,tr);
  tr.querySelectorAll("input").forEach(i=>i.oninput=updateAll);
  incomeTable.appendChild(tr);
}

function addSavingsRow(data={}){
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td><input value="${data.purpose||""}"></td>
    <td class="right"><input type="number" value="${data.amount||0}"></td>
    <td class="cell-tight"></td>`;
  addRemove(tr.lastElementChild,tr);
  tr.querySelectorAll("input").forEach(i=>i.oninput=updateAll);
  savingsTable.appendChild(tr);
}

function addDebtRow(data={}){
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td><input value="${data.name||""}"></td>
    <td class="right"><input type="number" value="${data.balance||0}"></td>
    <td class="right"><input type="number" value="${data.apr||0}"></td>
    <td class="right"><input type="number" value="${data.payment||0}"></td>
    <td class="right"><input type="number" value="${data.extra||0}"></td>
    <td class="right">$0.00</td>
    <td class="right">$0.00</td>
    <td class="right">$0.00</td>
    <td class="cell-tight"></td>`;
  addRemove(tr.lastElementChild,tr);
  tr.querySelectorAll("input").forEach(i=>i.oninput=updateAll);
  debtTable.appendChild(tr);
}

function addBillRow(data={}){
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td><input type="checkbox" ${data.paid?"checked":""}></td>
    <td><input value="${data.name||""}"></td>
    <td><input type="date" value="${data.due||""}"></td>
    <td class="right"><input type="number" value="${data.amount||0}"></td>
    <td><select></select></td>
    <td>
      <select>
        <option value="regular">Regular</option>
        <option value="principal">Extra Principal</option>
      </select>
    </td>
    <td class="right">$0.00</td>
    <td class="cell-tight"></td>`;
  addRemove(tr.lastElementChild,tr);
  tr.querySelectorAll("input,select").forEach(i=>i.oninput=updateAll);
  billsTable.appendChild(tr);
  updateDebtLinks();
}

/* -------------------------
   Buttons
------------------------- */
addIncomeBtn.onclick = ()=>!locked&&addIncomeRow();
addSavingsBtn.onclick= ()=>!locked&&addSavingsRow();
addDebtBtn.onclick   = ()=>!locked&&addDebtRow();
addBillBtn.onclick   = ()=>!locked&&addBillRow();

/* -------------------------
   Core calculation
------------------------- */
function updateDebtLinks(){
  const names=[...debtTable.querySelectorAll("tr")].map(r=>r.children[0].querySelector("input").value).filter(Boolean);
  billsTable.querySelectorAll("tr").forEach(r=>{
    const sel=r.children[4].querySelector("select");
    const cur=sel.value;
    sel.innerHTML=`<option value="">‚Äî</option>`+names.map(n=>`<option>${n}</option>`).join("");
    sel.value=cur;
  });
}

function updateAll(){
  let income=0,savings=0,bills=0,debtOut=0;
  updateDebtLinks();

  incomeTable.querySelectorAll("tr").forEach(r=>income+=num(r.children[2].querySelector("input").value));
  savingsTable.querySelectorAll("tr").forEach(r=>savings+=num(r.children[1].querySelector("input").value));

  const debtMap={};
  debtTable.querySelectorAll("tr").forEach(r=>{
    const name=r.children[0].querySelector("input").value;
    debtMap[name]={row:r,linkedPay:0,linkedExtra:0};
  });

  billsTable.querySelectorAll("tr").forEach(r=>{
    const paid=r.children[0].querySelector("input").checked;
    const amt=num(r.children[3].querySelector("input").value);
    const link=r.children[4].querySelector("select").value;
    const type=r.children[5].querySelector("select").value;
    if(!paid) bills+=amt;
    r.children[6].textContent=paid?money(0):money(amt);
    if(paid && link && debtMap[link]){
      type==="principal"?debtMap[link].linkedExtra+=amt:debtMap[link].linkedPay+=amt;
    }
  });

  debtTable.querySelectorAll("tr").forEach(r=>{
    const bal=num(r.children[1].querySelector("input").value);
    const apr=num(r.children[2].querySelector("input").value);
    const basePay=num(r.children[3].querySelector("input").value);
    const extra=num(r.children[4].querySelector("input").value);
    const name=r.children[0].querySelector("input").value;
    const lp=debtMap[name]?.linkedPay||0;
    const le=debtMap[name]?.linkedExtra||0;

    const interest=bal*(apr/100/12);
    const principal=Math.max(basePay+lp-interest,0)+extra+le;
    const newBal=Math.max(bal-principal,0);

    r.children[5].textContent=money(interest);
    r.children[6].textContent=money(principal);
    r.children[7].textContent=money(newBal);

    debtOut+=basePay+extra+lp+le;
  });

  const start=num(startingBalance.value);
  const remaining=start+income-bills-debtOut-savings;

  remainingAmt.textContent=money(remaining);
  remainingKpi.className="kpi "+(remaining>=0?"positive":"negative");

  oStart.textContent=money(start);
  oIncome.textContent=money(income);
  oBills.textContent=money(bills);
  oDebt.textContent=money(debtOut);
  oSavings.textContent=money(savings);
  oForward.textContent=money(remaining);

  saveAll();
}

/* -------------------------
   Save / Load
------------------------- */
function saveAll(){
  const data={
    locked,
    startingBalance:startingBalance.value,
    income:[...incomeTable.querySelectorAll("tr")].map(r=>({
      date:r.children[0].querySelector("input").value,
      source:r.children[1].querySelector("input").value,
      amount:r.children[2].querySelector("input").value
    })),
    savings:[...savingsTable.querySelectorAll("tr")].map(r=>({
      purpose:r.children[0].querySelector("input").value,
      amount:r.children[1].querySelector("input").value
    })),
    bills:[...billsTable.querySelectorAll("tr")].map(r=>({
      paid:r.children[0].querySelector("input").checked,
      name:r.children[1].querySelector("input").value,
      due:r.children[2].querySelector("input").value,
      amount:r.children[3].querySelector("input").value,
      link:r.children[4].querySelector("select").value,
      type:r.children[5].querySelector("select").value
    })),
    debt:[...debtTable.querySelectorAll("tr")].map(r=>({
      name:r.children[0].querySelector("input").value,
      balance:r.children[1].querySelector("input").value,
      apr:r.children[2].querySelector("input").value,
      payment:r.children[3].querySelector("input").value,
      extra:r.children[4].querySelector("input").value
    }))
  };
  localStorage.setItem(storageKey(),JSON.stringify(data));
}

function loadAll(){
  const raw=localStorage.getItem(storageKey());
  if(!raw){
    addIncomeRow();addSavingsRow();addBillRow();addDebtRow();
    return;
  }
  const d=JSON.parse(raw);
  locked=!!d.locked;
  app.classList.toggle("locked",locked);
  lockBtn.textContent=locked?"üîí Unlock":"üîì Lock Month";
  startingBalance.value=d.startingBalance||0;

  incomeTable.innerHTML="";savingsTable.innerHTML="";billsTable.innerHTML="";debtTable.innerHTML="";
  d.income.forEach(addIncomeRow);
  d.savings.forEach(addSavingsRow);
  d.bills.forEach(addBillRow);
  d.debt.forEach(addDebtRow);
  updateAll();
}

monthSel.onchange=yearSel.onchange=loadAll;
startingBalance.oninput=updateAll;

/* -------------------------
   Print
------------------------- */
printBtn.onclick=()=>window.print();

/* -------------------------
   Init
------------------------- */
loadAll();
</script>

</body>
</html>
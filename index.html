<!-- Budget App Code -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Paycheck Tracker â€“ Stable Base (Debug)</title>

<style>
:root{
  --bg:#f3f4f6;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --line:#e5e7eb;
  --brand:#007aff;
  --radius:16px;
  --shadow:0 10px 30px rgba(0,0,0,.06);
}

*{ box-sizing:border-box; }

body{
  margin:0;
  background:var(--bg);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif;
  color:var(--text);
}

.wrap{
  max-width:900px;
  margin:auto;
  padding:16px;
}

.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:16px;
  margin-bottom:16px;
}

h2{ margin:0 0 12px; font-size:18px; }

.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

.section-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}

#breakdownContent {
  display: grid;
  grid-template-columns: 1fr auto;
  row-gap: 6px;
}

.breakdown-line {
  display: contents;
}

.breakdown-line span:last-child {
  font-weight: 600;
}

.breakdown-total {
  margin-top: 6px;
  padding-top: 6px;
  border-top: 1px solid var(--line);
  font-weight: 700;
}

.section-toggle {
  font-size:13px;
  color:var(--muted);
}

.collapsed table,
.collapsed button {
  display:none;
}


input, select, button{
  padding:10px;
  border-radius:10px;
  border:1px solid var(--line);
  font-size:15px;
}

button{
  background:var(--brand);
  color:#fff;
  border:none;
  cursor:pointer;
}
button.secondary{ background:#94a3b8; }

table{ width:100%; border-collapse:collapse; }
th, td{ padding:8px; border-bottom:1px solid var(--line); text-align:left; }
th{ font-size:12px; color:var(--muted); }


table input {
  background: #fafafa;
}

table td {
  vertical-align: middle;
}

table tr:hover {
  background: #f8fafc;
}

.remove{ cursor:pointer; color:#94a3b8; font-size:18px; }
.remove:hover{ color:#ef4444; }

.kpi{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.kpi .value{ font-size:28px; font-weight:800; }

.sticky-remaining {
  position: sticky;
  top: 0;
  z-index: 10;
}

/* âœ… safer lock: disables inputs & add buttons, not the whole UI */
.locked input,
.locked select,
.locked .remove,
.locked #addIncome,
.locked #addBill,
.locked #addDebt{
  pointer-events:none;
  opacity:.6;
}

#debt th:nth-child(2),
#debt th:nth-child(3),
#debt th:nth-child(4),
#debt th:nth-child(5) {
  font-weight: 500;
}

#debt td:nth-child(6),
#debt td:nth-child(7),
#debt td:nth-child(8) {
  font-weight: 600;
}

/* debug pill */
#debug{
  font-size:12px;
  color:var(--muted);
  margin-top:8px;
}
#debug strong{ color:var(--text); }

@media (max-width:480px){
  .row{ grid-template-columns:1fr; }
}

/* ===== MOBILE: STOP HORIZONTAL SCROLL ===== */
@media (max-width: 430px) {

  /* Absolute final guard against sideways scroll */
  .wrap,
  .card,
  table,
  tbody,
  tr,
  td {
    max-width: 100%;
    overflow-x: hidden;
  }

  /* Inputs must never force width */
  tbody td input {
    width: 100%;
    max-width: 140px;   /* key line */
    box-sizing: border-box;
  }

}

@media (max-width: 430px) {

  /* Make mobile field labels readable */
  tbody td::before {
    color: #0f172a;        /* solid text */
    font-weight: 700;     /* stronger */
    font-size: 13px;
    opacity: 1;
  }

  /* Slight spacing so label/input donâ€™t blur together */
  tbody td {
    gap: 10px;
  }

}

  thead {
    display: none;
  }

  tbody tr {
    background: #ffffff;
    border: 1px solid var(--line);
    border-radius: 14px;
    padding: 12px;
    margin-bottom: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,.04);
  }

  tbody td {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
    border: none;
  }

  tbody td::before {
    content: attr(data-label);
    font-size: 12px;
    color: var(--muted);
    font-weight: 600;
  }

  tbody td input {
    max-width: 55%;
    text-align: right;
  }
}


/* ===== FINAL MOBILE LABEL FIX (DO NOT DUPLICATE ABOVE) ===== */

/* ===== DEBT CARDS ===== */

.debt-title{
  font-weight:700;
  font-size:16px;
  margin-bottom:10px;
}

.debt-field{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}

.debt-field label{
  font-size:13px;
  color:var(--muted);
}

.debt-field input{
  max-width:140px;
  text-align:right;
}

.debt-results{
  margin-top:10px;
  padding-top:10px;
  border-top:1px dashed var(--line);
  font-size:13px;
}

.debt-results div{
  display:flex;
  justify-content:space-between;
  margin-bottom:4px;
  font-weight:600;
}

.debt-remove{
  margin-top:10px;
  background:#e5e7eb;
  color:#334155;
}

/* ===== DEBT CARDS ===== */
.debt-card{
  border:1px solid var(--line);
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
  background:#fff;
  box-shadow:0 4px 12px rgba(0,0,0,.04);
}

.debt-title{
  font-weight:700;
  font-size:16px;
  margin-bottom:10px;
}

.debt-field{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}

.debt-field label{
  font-size:13px;
  color:var(--muted);
}

.debt-field input{
  max-width:140px;
  text-align:right;
}

.debt-results{
  margin-top:10px;
  padding-top:10px;
  border-top:1px dashed var(--line);
  font-size:13px;
}

.debt-results div{
  display:flex;
  justify-content:space-between;
  margin-bottom:4px;
  font-weight:600;
}

.debt-remove{
  margin-top:10px;
  background:#e5e7eb;
  color:#334155;
}
</style>
</head>

<body>
<div class="wrap" id="app">

  <!-- HEADER -->
  <div class="card">
    <div class="row">
      <select id="month"></select>
      <select id="year"></select>
    </div>

    <div class="row" style="margin-top:10px;">
      <input id="startingBalance" type="number" placeholder="Starting balance" />
      <button id="lockBtn" class="secondary" type="button">ðŸ”“ Lock Month</button>
    </div>

    <div id="debug">Status: <strong>loadingâ€¦</strong></div>
  </div>

  <!-- REMAINING -->
  <div class="card sticky-remaining">
    <div class="kpi">
      <div>Remaining This Month</div>
      <div class="value" id="remaining">$0.00</div>
<div class="card" id="breakdown" style="font-size:14px;color:#475569;">
  <div id="breakdownContent"></div>
</div>
    </div>
  </div>

<div class="card" id="summary" style="font-size:14px;color:#475569;">
</div>


  <!-- INCOME -->
  <div class="card">
    <div class="section-header" onclick="toggleSection(this)">
  <h2>Income</h2>
  <span class="section-toggle">Hide</span>
</div>

    <table>
      <thead>
  <tr>
    <th>Date</th>
    <th>Source</th>
    <th>Amount</th>
    <th></th>
  </tr>
</thead>
      <tbody id="income"></tbody>
    </table>
    <button id="addIncome" type="button">+ Add Income</button>
  </div>

  <!-- BILLS -->
  <div class="card">
    <div class="section-header" onclick="toggleSection(this)">
  <h2>Bills</h2>
  <span class="section-toggle">Hide</span>
</div>

    <table>
      <thead>
  <tr>
    <th>âœ”</th>
    <th>Due</th>
    <th>Paid</th>
    <th>Name</th>
    <th>Amount</th>
    <th></th>
  </tr>
</thead>
      <tbody id="bills"></tbody>
    </table>
    <button id="addBill" type="button">+ Add Bill</button>
  </div>

  <!-- DEBT -->
  <div class="card">
    <div class="section-header" onclick="toggleSection(this)">
  <h2>Debt</h2>
  <span class="section-toggle">Hide</span>
</div>

    <div id="debt"></div>
<button id="addDebt" type="button">+ Add Debt</button>
  </div>

</div>

<script>
/* ========= STABLE CORE (Debug) ========= */

const $ = id => document.getElementById(id);
const money = n => `$${(Number(n)||0).toFixed(2)}`;

const app      = $("app");
const debugEl  = $("debug");

const monthSel = $("month");
const yearSel  = $("year");
const startBal = $("startingBalance");

const incomeT  = $("income");
const billsT   = $("bills");
const debtT    = $("debt");

const remaining = $("remaining");
const lockBtn   = $("lockBtn");

let locked = false;

function setDebug(msg){
  debugEl.innerHTML = `Status: <strong>${msg}</strong>`;
}

/* Month / Year */
(function initMonthYear(){
  const now = new Date();
  for(let i=0;i<12;i++){
    monthSel.add(new Option(new Date(0,i).toLocaleString("default",{month:"long"}), i));
  }
  for(let y=2024;y<2036;y++){
    yearSel.add(new Option(y, y));
  }
  monthSel.value = now.getMonth();
  yearSel.value  = now.getFullYear();
})();

function toggleSection(header){
  const card = header.closest(".card");
  const label = header.querySelector(".section-toggle");

  card.classList.toggle("collapsed");
  label.textContent = card.classList.contains("collapsed")
    ? "Show"
    : "Hide";
}

function getIncomeData(){
  return [...incomeT.children].map(r => ({
    date: r.children[0].querySelector("input").value,
    source: r.children[1].querySelector("input").value,
    amount: r.children[2].querySelector("input").value
  }));
}

function getBillsData(){
  return [...billsT.children].map(r => ({
    paid: r.children[0].querySelector("input").checked,
    dueDate: r.children[1].querySelector("input").value,
    paidDate: r.children[2].querySelector("input").value,
    name: r.children[3].querySelector("input").value,
    amount: r.children[4].querySelector("input").value
  }));
}

function getDebtData(){
  return [...debtT.querySelectorAll(".debt-card")].map(card=>{
    const i = card.querySelectorAll("input");
    return {
      name: i[0].value,
      balance: i[1].value,
      apr: i[2].value,
      payment: i[3].value,
      extra: i[4].value
    };
  });
}


function clearTable(table){
  table.innerHTML = "";
}

function loadIncomeRows(data=[]){
  data.forEach(row => {
    addRow(incomeT, `
      <td data-label="Date"><input type="date" value="${row.date || ""}"></td>
      <td data-label="Source"><input value="${row.source || ""}"></td>
      <td data-label="Amount"><input type="number" inputmode="decimal" value="${row.amount || ""}"></td>
    `);
  });
}

function loadBillRows(data=[]){
  data.forEach(row => {
    addRow(billsT, `
      <td data-label="Paid"><input type="checkbox" ${row.paid ? "checked" : ""}></td>
      <td data-label="Due Date"><input type="date" value="${row.dueDate || ""}"></td>
      <td data-label="Paid Date"><input type="date" value="${row.paidDate || ""}"></td>
      <td data-label="Name"><input value="${row.name || ""}"></td>
      <td data-label="Amount"><input type="number" inputmode="decimal" value="${row.amount || ""}"></td>
    `);
  });
}

function loadDebtRows(data=[]){
  data.forEach(d => createDebtCard(d));
}

/* Row helper */
function addRow(table, cellsHtml){
  const tr = document.createElement("tr");
  tr.innerHTML = cellsHtml + `<td><span class="remove" title="Remove">Ã—</span></td>`;

  tr.querySelector(".remove").onclick = () => {
    if(locked) return;
    tr.remove();
	function renderBreakdown(start, income, bills, debt, remainingValue){
  const box = document.getElementById("breakdownContent");
  box.innerHTML = `
    update();
  };

  tr.querySelectorAll("input").forEach(i => {
    i.addEventListener("input", update);
    i.addEventListener("change", update);
  });

    <div class="breakdown-line">
      <span>Starting Balance</span>
      <span>${money(start)}</span>
    </div>

    <div class="breakdown-line">
      <span>Income</span>
      <span style="color:#16a34a">+${money(income)}</span>
    </div>

    <div class="breakdown-line">
      <span>Bills</span>
      <span style="color:#dc2626">âˆ’${money(bills)}</span>
    </div>

    <div class="breakdown-line">
      <span>Debt Payments</span>
      <span style="color:#dc2626">âˆ’${money(debt)}</span>
    </div>

    <div class="breakdown-line breakdown-total">
      <span>Remaining</span>
      <span>${money(remainingValue)}</span>
    </div>
  `;
}
  const paid = tr.querySelector('td[data-label="Paid"] input');
  const paidDate = tr.querySelector('td[data-label="Paid Date"] input');

  if(paid && paidDate){
    paid.addEventListener("change", () => {
      paidDate.disabled = !paid.checked;
      if(paid.checked && !paidDate.value){
        paidDate.value = new Date().toISOString().slice(0,10);
      }
    });
  }
}

  tr.querySelectorAll("input, select").forEach(el => {
    el.addEventListener("input", update);
    el.addEventListener("change", update);
  });

  table.appendChild(tr);   // âœ… the key line
  update();
}

/* Buttons */
$("addIncome").addEventListener("click", () => {
  setDebug("Add Income clicked âœ…");
  if(locked) return;

  addRow(incomeT, `
    <td data-label="Date">
      <input type="date">
    </td>
    <td data-label="Source">
      <input>
    </td>
    <td data-label="Amount">
      <input type="number" inputmode="decimal">
    </td>
  `);
});

$("addBill").addEventListener("click", () => {
  setDebug("Add Bill clicked âœ…");
  if(locked) return;

  addRow(billsT, `
    <td data-label="Paid">
      <input type="checkbox">
    </td>
    <td data-label="Due Date">
      <input type="date">
    </td>
    <td data-label="Paid Date">
      <input type="date" disabled>
    </td>
    <td data-label="Name">
      <input>
    </td>
    <td data-label="Amount">
      <input type="number" inputmode="decimal">
    </td>
  `);
});

function createDebtCard(data = {}){
  const card = document.createElement("div");
  card.className = "debt-card";

  card.innerHTML = `
    <div class="debt-title">
      <input placeholder="Debt name" value="${data.name || ""}">
    </div>

    <div class="debt-field">
      <label>Balance</label>
      <input type="number" inputmode="decimal" value="${data.balance || ""}">
    </div>

    <div class="debt-field">
      <label>APR %</label>
      <input type="number" inputmode="decimal" value="${data.apr || ""}">
    </div>

    <div class="debt-field">
      <label>Payment</label>
      <input type="number" inputmode="decimal" value="${data.payment || ""}">
    </div>

    <div class="debt-field">
      <label>Extra</label>
      <input type="number" inputmode="decimal" value="${data.extra || ""}">
    </div>

    <div class="debt-results">
      <div><span>Interest</span><span class="interest">$0.00</span></div>
      <div><span>Principal</span><span class="principal">$0.00</span></div>
      <div><span>New Balance</span><span class="newbal">$0.00</span></div>
    </div>

    <button class="debt-remove">Remove Debt</button>
  `;

  card.querySelector(".debt-remove").onclick = () => {
    if(locked) return;
    card.remove();
    update();
  };

  card.querySelectorAll("input").forEach(i=>{
    i.addEventListener("input", update);
  });

  debtT.appendChild(card);
}


/* Lock */
lockBtn.addEventListener("click", () => {
  locked = !locked;
  app.classList.toggle("locked", locked);
  lockBtn.textContent = locked
    ? "ðŸ”’ Month Locked"
    : "ðŸ”“ Lock Month";

  save(); // ðŸ”‘ saves lock state to THIS month only
  setDebug(locked ? "Month locked" : "Month unlocked");
});

/* Calculate */
function sumIncome(){
  let total = 0;

  incomeT.querySelectorAll("tr").forEach(row=>{
    const amt = Number(
      row.querySelector('td[data-label="Amount"] input')?.value
    ) || 0;

    total += amt;
  });

  return total;
}

function sumBills(){
  let total = 0;

  billsT.querySelectorAll("tr").forEach(r=>{
    const amt = Number(
      r.querySelector('td[data-label="Amount"] input')?.value
    ) || 0;

    total += amt;

    const paid = r.querySelector('td[data-label="Paid"] input')?.checked;
    r.style.opacity = paid ? 0.45 : 1;
  });

  return total;
}

function calcDebtOut(){
  let total = 0;

  debtT.querySelectorAll(".debt-card").forEach(card=>{
    const inputs = card.querySelectorAll("input");

    const bal   = Number(inputs[1].value) || 0;
    const apr   = Number(inputs[2].value) || 0;
    const pay   = Number(inputs[3].value) || 0;
    const extra = Number(inputs[4].value) || 0;

    const interest  = bal * (apr / 100 / 12);
    const principal = Math.max(pay - interest, 0) + extra;
    const newBal    = Math.max(bal - principal, 0);

    card.querySelector(".interest").textContent  = money(interest);
    card.querySelector(".principal").textContent = money(principal);
    card.querySelector(".newbal").textContent    = money(newBal);

    total += pay + extra;
  });

  return total;
}

function renderSummary(){
  document.getElementById("summary").textContent =
    "Monthly activity updated.";
}
renderSummary();


function update(){
  const start  = Number(startBal.value) || 0;
  const income = sumIncome();
  const bills = sumBills();
  const debt   = calcDebtOut();

  const remainingValue = start + income - bills - debt;
  remaining.textContent = money(remainingValue);

  renderBreakdown(start, income, bills, debt, remainingValue);

  save();
}

/* Save / Load (minimal + safe) */
function key(){
  return `stable-${yearSel.value}-${monthSel.value}`;
}

function save(){
  localStorage.setItem(key(), JSON.stringify({
    locked,
    start: startBal.value || "",
    income: getIncomeData(),
    bills: getBillsData(),
    debt: getDebtData()
  }));
}

function load(){
  const d = JSON.parse(localStorage.getItem(key()) || "{}");

  // ðŸ”‘ Lock is now month-scoped
  locked = !!d.locked;

  app.classList.toggle("locked", locked);
  lockBtn.textContent = locked
    ? "ðŸ”’ Month Locked"
    : "ðŸ”“ Lock Month";

  startBal.value = d.start || "";

  clearTable(incomeT);
  clearTable(billsT);
  clearTable(debtT);

  loadIncomeRows(d.income);
  loadBillRows(d.bills);
  loadDebtRows(d.debt);

  update();
  setDebug("Loaded month data âœ…");
}

 
load();

localStorage.clear();
location.reload();

</script>
</body>
</html>
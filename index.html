<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Paycheck Tracker â€“ Stable Base (Recurring Bills)</title>

<style>
:root{
  --bg:#f3f4f6;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --line:#e5e7eb;
  --brand:#007aff;
  --radius:16px;
  --shadow:0 10px 30px rgba(0,0,0,.06);
}
*{ box-sizing:border-box; }
body{
  margin:0;
  background:var(--bg);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif;
  color:var(--text);
}
.wrap{ max-width:900px; margin:auto; padding:16px; }
.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:16px;
  margin-bottom:16px;
}
h2{ margin:0 0 12px; font-size:18px; }
.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
.section-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}
.section-toggle{ font-size:13px; color:var(--muted); }
.collapsed table,
.collapsed button,
.collapsed #debt,
.collapsed .template-ui {
  display:none;
}

input, select, button{
  padding:10px;
  border-radius:10px;
  border:1px solid var(--line);
  font-size:15px;
}
button{
  background:var(--brand);
  color:#fff;
  border:none;
  cursor:pointer;
}
button.secondary{ background:#94a3b8; }

table{ width:100%; border-collapse:collapse; }
th, td{ padding:8px; border-bottom:1px solid var(--line); text-align:left; }
th{ font-size:12px; color:var(--muted); }
table input{ background:#fafafa; }
table tr:hover{ background:#f8fafc; }

.remove{ cursor:pointer; color:#94a3b8; font-size:18px; user-select:none; }
.remove:hover{ color:#ef4444; }

.kpi{ display:flex; justify-content:space-between; align-items:center; }
.kpi .value{ font-size:28px; font-weight:800; }

.sticky-remaining{ position: sticky; top:0; z-index:10; }

#breakdownContent{
  display:grid;
  grid-template-columns:1fr auto;
  row-gap:6px;
}
.breakdown-line{ display:contents; }
.breakdown-line span:last-child{ font-weight:600; }
.breakdown-total{
  margin-top:6px;
  padding-top:6px;
  border-top:1px solid var(--line);
  font-weight:700;
}

/* Lock ONLY data entry â€” never navigation */
.locked #income input,
.locked #bills input,
.locked #debt input,
.locked .remove,
.locked .debt-remove,
.locked #addIncome,
.locked #addBill,
.locked #addDebt {
  pointer-events:none;
  opacity:.6;
}

/* debug */
#debug{
  font-size:12px;
  color:var(--muted);
  margin-top:8px;
}
#debug strong{ color:var(--text); }

/* Debt cards */
.debt-card{
  border:1px solid var(--line);
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
  background:#fff;
  box-shadow:0 4px 12px rgba(0,0,0,.04);
}
.debt-title input{
  width:100%;
  font-weight:700;
  font-size:16px;
  margin-bottom:10px;
}
.debt-field{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
  gap:12px;
}
.debt-field label{ font-size:13px; color:var(--muted); }
.debt-field input{ max-width:140px; text-align:right; }
.debt-results{
  margin-top:10px;
  padding-top:10px;
  border-top:1px dashed var(--line);
  font-size:13px;
}
.debt-results div{
  display:flex;
  justify-content:space-between;
  margin-bottom:4px;
  font-weight:600;
}
.debt-remove{
  margin-top:10px;
  background:#e5e7eb;
  color:#334155;
}

/* Template UI */
.template-ui{
  border-top:1px solid var(--line);
  padding-top:12px;
  margin-top:12px;
}
.template-row{
  display:grid;
  grid-template-columns: 1.4fr 1fr .8fr .8fr auto;
  gap:10px;
  align-items:center;
}
.template-row input, .template-row select{
  width:100%;
}
.template-row .remove{
  font-size:20px;
  padding:0 6px;
}

/* Mobile stacked table cards */
@media (max-width:480px){
  .row{ grid-template-columns:1fr; }
  .template-row{
    grid-template-columns: 1fr 1fr;
  }
}

@media (max-width: 430px) {
  thead { display:none; }

  tbody tr{
    background:#fff;
    border:1px solid var(--line);
    border-radius:14px;
    padding:12px;
    margin-bottom:12px;
    box-shadow:0 4px 12px rgba(0,0,0,.04);
    display:block;
  }

  tbody td{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    padding:6px 0;
    border:none;
  }

  tbody td::before{
    content: attr(data-label);
    font-weight:700;
    font-size:13px;
  }

  td[data-label="Recurring"],
  td[data-label="Linked Debt"] {
    display: none;
  }

  table {
    width: 100%;
    overflow-x: hidden;
  }
}
</style>
</head>

<body>
<div class="wrap" id="app">

  <!-- HEADER -->
  <div class="card">
    <div class="row">
      <select id="month"></select>
      <select id="year"></select>
    </div>

    <div class="row" style="margin-top:10px;">
      <input id="startingBalance" type="number" placeholder="Starting balance" inputmode="decimal" />
      <button id="lockBtn" class="secondary" type="button">ðŸ”“ Lock Month</button>
    </div>

    <div id="debug">Status: <strong>loadingâ€¦</strong></div>
  </div>

  <!-- REMAINING -->
  <div class="card sticky-remaining">
    <div class="kpi">
      <div>Remaining This Month</div>
      <div class="value" id="remaining">$0.00</div>
    </div>

    <div class="card" id="breakdown" style="font-size:14px;color:#475569;margin-top:12px;">
      <div id="breakdownContent"></div>
    </div>
  </div>

  <div class="card" id="summary" style="font-size:14px;color:#475569;"></div>

  <!-- INCOME -->
  <div class="card">
    <div class="section-header" onclick="toggleSection(this)">
      <h2>Income</h2>
      <span class="section-toggle">Hide</span>
    </div>

    <table>
      <thead>
        <tr><th>Date</th><th>Source</th><th>Amount</th><th></th></tr>
      </thead>
      <tbody id="income"></tbody>
    </table>
    <button id="addIncome" type="button">+ Add Income</button>
  </div>

  <!-- BILLS -->
  <div class="card">
    <div class="section-header" onclick="toggleSection(this)">
      <h2>Bills</h2>
      <span class="section-toggle">Hide</span>
    </div>

    <table>
      <thead>
        <tr><th>âœ”</th><th>Due</th><th>Paid</th><th>Name</th><th>Amount</th><th></th></tr>
      </thead>
      <tbody id="bills"></tbody>
    </table>

    <button id="addBill" type="button">+ Add Bill</button>

    <!-- Template manager -->
    <div class="template-ui">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
        <div style="font-weight:700;">Recurring Bills</div>
        <button id="addTemplate" type="button" class="secondary">+ Add Recurring Bill</button>
      </div>
      <div id="templates" style="margin-top:10px; display:grid; gap:10px;"></div>
      <div style="font-size:12px; color:var(--muted); margin-top:10px;">
        Recurring bills automatically appear in each month (once). You can still edit the due date/amount in a specific month without changing the template.
      </div>
    </div>
  </div>

  <!-- DEBT -->
  <div class="card">
    <div class="section-header" onclick="toggleSection(this)">
      <h2>Debt</h2>
      <span class="section-toggle">Hide</span>
    </div>

    <div id="debt"></div>
    <button id="addDebt" type="button">+ Add Debt</button>
  </div>

</div>

<script>
/* ========= STABLE CORE + RECURRING BILLS ========= */
const $ = id => document.getElementById(id);
const money = n => `$${(Number(n) || 0).toFixed(2)}`;

const app      = $("app");
const debugEl  = $("debug");

const monthSel = $("month");
const yearSel  = $("year");
const startBal = $("startingBalance");

const incomeT  = $("income");
const billsT   = $("bills");
const debtT    = $("debt");

const remaining = $("remaining");
const lockBtn   = $("lockBtn");

const templatesEl = $("templates");
const addTemplateBtn = $("addTemplate");

let locked = false;

function setDebug(msg){
  debugEl.innerHTML = `Status: <strong>${msg}</strong>`;
}

/* ===== Templates (global) ===== */
function getBillTemplates(){
  return JSON.parse(localStorage.getItem("bill-templates") || "[]");
}
function saveBillTemplates(templates){
  localStorage.setItem("bill-templates", JSON.stringify(templates));
}

/* Month / Year */
(function initMonthYear(){
  const now = new Date();
  for(let i=0;i<12;i++){
    monthSel.add(new Option(new Date(0,i).toLocaleString("default",{month:"long"}), i));
  }
  for(let y=2024;y<2036;y++){
    yearSel.add(new Option(y, y));
  }
  monthSel.value = now.getMonth();
  yearSel.value  = now.getFullYear();
})();

function key(){
  return `stable-${yearSel.value}-${monthSel.value}`;
}

function toggleSection(header){
  const card = header.closest(".card");
  const label = header.querySelector(".section-toggle");
  card.classList.toggle("collapsed");
  label.textContent = card.classList.contains("collapsed") ? "Show" : "Hide";
}

/* ===== Data getters ===== */
function getIncomeData(){
  return [...incomeT.querySelectorAll("tr")].map(r => ({
    date:   r.querySelector('td[data-label="Date"] input')?.value || "",
    source: r.querySelector('td[data-label="Source"] input')?.value || "",
    amount: r.querySelector('td[data-label="Amount"] input')?.value || ""
  }));
}

function getBillsData(){
  return [...billsT.querySelectorAll("tr")].map(r => ({
    templateId: r.dataset.templateId || null,
    paid: r.querySelector('[data-label="Paid"] input')?.checked || false,
    dueDate: r.querySelector('[data-label="Due Date"] input')?.value || "",
    paidDate: r.querySelector('[data-label="Paid Date"] input')?.value || "",
    name: r.querySelector('[data-label="Name"] input')?.value || "",
    amount: r.querySelector('[data-label="Amount"] input')?.value || "",
    linkedDebtId: r.querySelector('[data-label="Linked Debt"] select')?.value || ""
  }));
}

function getDebtData(){
  return [...debtT.querySelectorAll(".debt-card")].map(card=>{
    const i = card.querySelectorAll("input");
    return {
      id:      card.dataset.debtId,
      name:    i[0].value,
      balance: i[1].value,
      apr:     i[2].value,
      payment: i[3].value,
      extra:   i[4].value
    };
  });
}

function clear(el){ el.innerHTML = ""; }

/* ===== Helpers ===== */
function clampDueDate(year, monthIndex, dueDay){
  const y = Number(year);
  const m = Number(monthIndex);
  const d = Math.max(1, Number(dueDay) || 1);

  // last day of month: day 0 of next month
  const lastDay = new Date(y, m + 1, 0).getDate();
  const dd = Math.min(d, lastDay);

  return new Date(y, m, dd).toISOString().slice(0,10);
}

/* ===== Row builder (for income + bills) ===== */
function addRow(tbody, cellsHtml, templateId = null){
  const tr = document.createElement("tr");
  tr.dataset.templateId = templateId ? String(templateId) : "";
  tr.innerHTML = cellsHtml + `<td><span class="remove" title="Remove">Ã—</span></td>`;

const debtSelect = tr.querySelector('[data-label="Linked Debt"] select');
if(debtSelect){
  populateDebtSelect(debtSelect);
  debtSelect.addEventListener("change", update);
}
  tr.querySelector(".remove").addEventListener("click", () => {
    if(locked) return;
    tr.remove();
    update();
  });

  // Wire all inputs
  tr.querySelectorAll("input").forEach(input => {
    input.addEventListener("input", update);
    input.addEventListener("change", update);
  });

  // Bills: paid checkbox controls paid date
  const paid = tr.querySelector('td[data-label="Paid"] input');
  const paidDate = tr.querySelector('td[data-label="Paid Date"] input');

  if(paid && paidDate){
    const sync = () => {
      if(paid.checked){
        paidDate.disabled = false;
        if(!paidDate.value){
          paidDate.value = new Date().toISOString().slice(0,10);
        }
      } else {
        paidDate.value = "";
        paidDate.disabled = true;
      }
    };
    sync(); // important on load
    paid.addEventListener("change", () => { sync(); update(); });
  }

  tbody.appendChild(tr);
}

function populateDebtSelect(select, selectedId = ""){
  select.innerHTML = `<option value="">â€” None â€”</option>`;

  getDebtData().forEach(d => {
    const opt = document.createElement("option");
    opt.value = d.id;
    opt.textContent = d.name || "Unnamed Debt";
    if(d.id === selectedId) opt.selected = true;
    select.appendChild(opt);
  });
}

function refreshAllDebtSelects(){
  // For every bill row that has a linked-debt select:
  billsT.querySelectorAll('tr').forEach(tr => {
    const select = tr.querySelector('[data-label="Linked Debt"] select');
    if(!select) return;

    // Preserve current selection if any
    const current = select.value || "";
    populateDebtSelect(select, current);
  });
}

function upsertBillTemplate(row){
  const recurring = row.querySelector('[data-label="Recurring"] input');
  if(!recurring || !recurring.checked) return;

  const name   = row.querySelector('[data-label="Name"] input').value;
  const amount = row.querySelector('[data-label="Amount"] input').value;
  const due    = row.querySelector('[data-label="Due Date"] input').value;

  if(!name || !amount || !due) return;

  const dueDay = new Date(due).getDate();

  let templates = getBillTemplates();

  let existing = templates.find(t => t.name === name);

  if(!existing){
    templates.push({
      id: crypto.randomUUID(),
      name,
      amount,
      dueDay,
      recurring: true
    });
  }

  saveBillTemplates(templates);
}

function applyBillPaymentsToDebt(){
  const debts = getDebtData();

  billsT.querySelectorAll("tr").forEach(row=>{
    const paid = row.querySelector('[data-label="Paid"] input')?.checked;
    if(!paid) return;

    const debtId = row.querySelector('[data-label="Linked Debt"] select')?.value;
    if(!debtId) return;

    const amount = Number(
      row.querySelector('[data-label="Amount"] input')?.value
    ) || 0;

    const debt = debts.find(d => d.id === debtId);
    if(!debt || amount <= 0) return;

    const apr = Number(debt.apr) || 0;
    const interest = (Number(debt.balance) || 0) * (apr / 100 / 12);
    const principal = Math.max(amount - interest, 0);

    debt.balance = Math.max(
      Number(debt.balance) - principal,
      0
    );
  });

  // Write balances back to UI
  debtT.querySelectorAll(".debt-card").forEach(card=>{
    const id = card.dataset.debtId;
    const d = debts.find(x => x.id === id);
    if(!d) return;

    card.querySelectorAll("input")[1].value = d.balance;
  });
}

/* ===== Debt cards ===== */
function createDebtCard(data = {}){
  const card = document.createElement("div");
  card.className = "debt-card";
  card.dataset.debtId = data.id || crypto.randomUUID();

  card.innerHTML = `
    <div class="debt-title">
      <input placeholder="Debt name" value="${data.name || ""}">
    </div>

    <div class="debt-field">
      <label>Balance</label>
      <input type="number" inputmode="decimal" value="${data.balance || ""}">
    </div>

    <div class="debt-field">
      <label>APR %</label>
      <input type="number" inputmode="decimal" value="${data.apr || ""}">
    </div>

    <div class="debt-field">
      <label>Payment</label>
      <input type="number" inputmode="decimal" value="${data.payment || ""}">
    </div>

    <div class="debt-field">
      <label>Extra</label>
      <input type="number" inputmode="decimal" value="${data.extra || ""}">
    </div>

    <div class="debt-results">
      <div><span>Interest</span><span class="interest">$0.00</span></div>
      <div><span>Principal</span><span class="principal">$0.00</span></div>
      <div><span>New Balance</span><span class="newbal">$0.00</span></div>
    </div>

    <button class="debt-remove" type="button">Remove Debt</button>
  `;

  card.querySelector(".debt-remove").addEventListener("click", () => {
    if(locked) return;
    card.remove();
    update();
  });

  card.querySelectorAll("input").forEach(i => i.addEventListener("input", () => {
  refreshAllDebtSelects();   // keep bill dropdowns in sync with debt list/names
  update();
}));

  debtT.appendChild(card);
}

/* ===== Loaders ===== */
function loadIncomeRows(data=[]){
  data.forEach(row => {
    addRow(incomeT, `
      <td data-label="Date"><input type="date" value="${row.date || ""}"></td>
      <td data-label="Source"><input value="${row.source || ""}"></td>
      <td data-label="Amount"><input type="number" inputmode="decimal" value="${row.amount || ""}"></td>
    `);
  });
}

function loadBillRows(data = []){

  // 1ï¸âƒ£ Load saved bills for this month
  data.forEach(row => {

    addRow(billsT, `
      <td data-label="Paid">
        <input type="checkbox" ${row.paid ? "checked" : ""}>
      </td>
      <td data-label="Due Date">
        <input type="date" value="${row.dueDate || ""}">
      </td>
      <td data-label="Paid Date">
        <input type="date" value="${row.paidDate || ""}">
      </td>
      <td data-label="Name">
        <input value="${row.name || ""}">
      </td>
      <td data-label="Amount">
        <input type="number" inputmode="decimal" value="${row.amount || ""}">
      </td>
      <td data-label="Recurring">
        <input type="checkbox">
      </td>
      <td data-label="Linked Debt">
        <select></select>
      </td>
    `);

    // âœ… RESTORE LINKED DEBT
    const tr = billsT.lastElementChild;
    const select = tr.querySelector('[data-label="Linked Debt"] select');
    if (select && row.linkedDebtId) {
      populateDebtSelect(select, row.linkedDebtId);
    }
  });

  // 2ï¸âƒ£ Inject recurring templates (once per month)
  const templates = getBillTemplates();
  const existingNames = new Set(
    [...billsT.children].map(r =>
      r.querySelector('[data-label="Name"] input')?.value
    )
  );

  templates.forEach(t => {
    if(!t.recurring) return;
    if(existingNames.has(t.name)) return;

    const due = new Date(
      yearSel.value,
      monthSel.value,
      t.dueDay
    ).toISOString().slice(0,10);

    addRow(billsT, `
      <td data-label="Paid"><input type="checkbox"></td>
      <td data-label="Due Date"><input type="date" value="${due}"></td>
      <td data-label="Paid Date"><input type="date" disabled></td>
      <td data-label="Name"><input value="${t.name}"></td>
      <td data-label="Amount"><input type="number" inputmode="decimal" value="${t.amount}"></td>
      <td data-label="Recurring"><input type="checkbox" checked></td>
      <td data-label="Linked Debt"><select></select></td>
    `);
  });
}

  

function loadDebtRows(data=[]){
  data.forEach(d => createDebtCard(d));
}

/* ===== Calculations ===== */
function sumIncome(){
  let total = 0;
  incomeT.querySelectorAll("tr").forEach(r=>{
    const amt = Number(r.querySelector('td[data-label="Amount"] input')?.value) || 0;
    total += amt;
  });
  return total;
}

function sumBills(){
  let total = 0;

  billsT.querySelectorAll("tr").forEach(r=>{
    const amt = Number(r.querySelector('td[data-label="Amount"] input')?.value) || 0;
    total += amt;

    // visual only
    const paid = r.querySelector('td[data-label="Paid"] input')?.checked;
    r.style.opacity = paid ? 0.45 : 1;
  });

  return total;
}


function renderBreakdown(start, income, bills, remainingValue){
  $("breakdownContent").innerHTML = `
    <div class="breakdown-line"><span>Starting Balance</span><span>${money(start)}</span></div>
    <div class="breakdown-line"><span>Income</span><span style="color:#16a34a">+${money(income)}</span></div>
    <div class="breakdown-line"><span>Bills</span><span style="color:#dc2626">âˆ’${money(bills)}</span></div>
    <div class="breakdown-line breakdown-total"><span>Remaining</span><span>${money(remainingValue)}</span></div>
  `;
}

function update(){
  const start  = Number(startBal.value) || 0;
  const income = sumIncome();
  const bills  = sumBills();

  const remainingValue = start + income - bills;

  remaining.textContent = money(remainingValue);

  billsT.querySelectorAll("tr").forEach(upsertBillTemplate);
  applyBillPaymentsToDebt();

  renderBreakdown(start, income, bills, remainingValue);
  $("summary").textContent = "Monthly activity updated.";

  save();
}

/* ===== Save / Load ===== */
function save(){
  if(!lastKey) lastKey = key();

  localStorage.setItem(lastKey, JSON.stringify({
    locked,
    start: startBal.value || "",
    income: getIncomeData(),
    bills: getBillsData(),
    debt: getDebtData()
  }));
}

function load(){
  lastKey = key(); // this month is now active

  const d = JSON.parse(localStorage.getItem(lastKey) || "{}");

  // ðŸ”‘ LOCK IS READ ONLY FROM THIS MONTH
  locked = !!d.locked;

  app.classList.toggle("locked", locked);
  lockBtn.textContent = locked ? "ðŸ”’ Month Locked" : "ðŸ”“ Lock Month";

  startBal.value = d.start || "";

  clear(incomeT);
  clear(billsT);
  clear(debtT);

  loadIncomeRows(d.income || []);
loadDebtRows(d.debt || []);     // âœ… debt first
loadBillRows(d.bills || []);     // âœ… then bills
refreshAllDebtSelects();         // âœ… now the dropdowns fill correctly

  update();
renderTemplatesUI();
  setDebug(`Loaded ${yearSel.value}-${Number(monthSel.value) + 1} âœ…`);
}

/* ===== Recurring bill templates UI ===== */
function uid(){
  return "t_" + Math.random().toString(36).slice(2, 10);
}

function renderTemplatesUI(){
  const templates = getBillTemplates();

  templatesEl.innerHTML = "";
  if(templates.length === 0){
    templatesEl.innerHTML = `<div style="color:var(--muted); font-size:13px;">No recurring bills yet.</div>`;
    return;
  }

  templates.forEach(t => {
    const row = document.createElement("div");
    row.className = "template-row";
    row.innerHTML = `
      <input data-k="name" placeholder="Name (e.g., Rent)" value="${t.name || ""}">
      <input data-k="amount" type="number" inputmode="decimal" placeholder="Amount" value="${t.amount ?? ""}">
      <input data-k="dueDay" type="number" min="1" max="31" placeholder="Due day" value="${t.dueDay ?? ""}">
      <select data-k="recurring">
        <option value="true" ${t.recurring ? "selected" : ""}>Recurring</option>
        <option value="false" ${!t.recurring ? "selected" : ""}>Off</option>
      </select>
      <span class="remove" title="Remove">Ã—</span>
    `;

    // Change handlers
    row.querySelectorAll("input, select").forEach(el => {
      el.addEventListener("input", () => {
        const updated = getBillTemplates().map(x => {
          if(String(x.id) !== String(t.id)) return x;
          const name = row.querySelector('[data-k="name"]').value;
          const amount = row.querySelector('[data-k="amount"]').value;
          const dueDay = row.querySelector('[data-k="dueDay"]').value;
          const recurring = row.querySelector('[data-k="recurring"]').value === "true";
          return {
            ...x,
            name,
            amount,
            dueDay,
            recurring
          };
        });
        saveBillTemplates(updated);
      });
    });

    row.querySelector(".remove").addEventListener("click", () => {
      const updated = getBillTemplates().filter(x => String(x.id) !== String(t.id));
      saveBillTemplates(updated);
      renderTemplatesUI();
    });

    templatesEl.appendChild(row);
  });
}

addTemplateBtn.addEventListener("click", () => {
  const templates = getBillTemplates();
  templates.push({
    id: uid(),
    name: "",
    amount: "",
    dueDay: 1,
    recurring: true
  });
  saveBillTemplates(templates);
  renderTemplatesUI();
});

/* ===== Events ===== */
startBal.addEventListener("input", update);
startBal.addEventListener("change", update);

$("addIncome").addEventListener("click", () => {
  setDebug("Add Income clicked âœ…");
  if(locked) return;
  addRow(incomeT, `
    <td data-label="Date"><input type="date"></td>
    <td data-label="Source"><input></td>
    <td data-label="Amount"><input type="number" inputmode="decimal"></td>
  `);
  update();
});

$("addBill").addEventListener("click", () => {
  setDebug("Add Bill clicked âœ…");
  if(locked) return;
  addRow(billsT, `
    <td data-label="Paid"><input type="checkbox"></td>
    <td data-label="Due Date"><input type="date"></td>
    <td data-label="Paid Date"><input type="date" disabled></td>
    <td data-label="Name"><input></td>
    <td data-label="Amount"><input type="number" inputmode="decimal"></td>
  `);
  update();
});

$("addDebt").addEventListener("click", () => {
  setDebug("Add Debt clicked âœ…");
  if(locked) return;
  createDebtCard();
  refreshAllDebtSelects();
  update();
});

lockBtn.addEventListener("click", () => {
  locked = !locked;
  app.classList.toggle("locked", locked);
  lockBtn.textContent = locked ? "ðŸ”’ Month Locked" : "ðŸ”“ Lock Month";
  save();
  setDebug(locked ? "Month locked âœ…" : "Month unlocked âœ…");
});

function handleMonthChange(){
  // Save current month before switching
  save();
  // Load newly selected month
  load();
}

monthSel.addEventListener("change", handleMonthChange);
yearSel.addEventListener("change", handleMonthChange);

/* Boot */
load();
</script>
</body>
</html>
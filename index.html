<!-- Budget App Code -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Paycheck Tracker â€“ Stable Base (Debug)</title>

<style>
:root{
  --bg:#f3f4f6;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --line:#e5e7eb;
  --brand:#007aff;
  --radius:16px;
  --shadow:0 10px 30px rgba(0,0,0,.06);
}

*{ box-sizing:border-box; }

body{
  margin:0;
  background:var(--bg);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif;
  color:var(--text);
}

.wrap{
  max-width:900px;
  margin:auto;
  padding:16px;
}

.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:16px;
  margin-bottom:16px;
}

h2{ margin:0 0 12px; font-size:18px; }

.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

.section-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}

.section-toggle {
  font-size:13px;
  color:var(--muted);
}

.collapsed table,
.collapsed button {
  display:none;
}


input, select, button{
  padding:10px;
  border-radius:10px;
  border:1px solid var(--line);
  font-size:15px;
}

button{
  background:var(--brand);
  color:#fff;
  border:none;
  cursor:pointer;
}
button.secondary{ background:#94a3b8; }

table{ width:100%; border-collapse:collapse; }
th, td{ padding:8px; border-bottom:1px solid var(--line); text-align:left; }
th{ font-size:12px; color:var(--muted); }


table input {
  background: #fafafa;
}

table td {
  vertical-align: middle;
}

table tr:hover {
  background: #f8fafc;
}

.remove{ cursor:pointer; color:#94a3b8; font-size:18px; }
.remove:hover{ color:#ef4444; }

.kpi{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.kpi .value{ font-size:28px; font-weight:800; }

.sticky-remaining {
  position: sticky;
  top: 0;
  z-index: 10;
}

/* âœ… safer lock: disables inputs & add buttons, not the whole UI */
.locked input,
.locked select,
.locked .remove,
.locked #addIncome,
.locked #addBill,
.locked #addDebt{
  pointer-events:none;
  opacity:.6;
}

#debt th:nth-child(2),
#debt th:nth-child(3),
#debt th:nth-child(4),
#debt th:nth-child(5) {
  font-weight: 500;
}

#debt td:nth-child(6),
#debt td:nth-child(7),
#debt td:nth-child(8) {
  font-weight: 600;
}

/* debug pill */
#debug{
  font-size:12px;
  color:var(--muted);
  margin-top:8px;
}
#debug strong{ color:var(--text); }

@media (max-width:480px){
  .row{ grid-template-columns:1fr; }
}

/* ===== MOBILE: STOP HORIZONTAL SCROLL ===== */
@media (max-width: 430px) {

  /* Absolute final guard against sideways scroll */
  .wrap,
  .card,
  table,
  tbody,
  tr,
  td {
    max-width: 100%;
    overflow-x: hidden;
  }

  /* Inputs must never force width */
  tbody td input {
    width: 100%;
    max-width: 140px;   /* key line */
    box-sizing: border-box;
  }

}

@media (max-width: 430px) {

  /* Make mobile field labels readable */
  tbody td::before {
    color: #0f172a;        /* solid text */
    font-weight: 700;     /* stronger */
    font-size: 13px;
    opacity: 1;
  }

  /* Slight spacing so label/input donâ€™t blur together */
  tbody td {
    gap: 10px;
  }

}

  thead {
    display: none;
  }

  tbody tr {
    background: #ffffff;
    border: 1px solid var(--line);
    border-radius: 14px;
    padding: 12px;
    margin-bottom: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,.04);
  }

  tbody td {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
    border: none;
  }

  tbody td::before {
    content: attr(data-label);
    font-size: 12px;
    color: var(--muted);
    font-weight: 600;
  }

  tbody td input {
    max-width: 55%;
    text-align: right;
  }
}


/* ===== FINAL MOBILE LABEL FIX (DO NOT DUPLICATE ABOVE) ===== */
@media (max-width: 430px) {

  thead {
    display: none;
  }

  tbody tr {
    background: #ffffff;
    border: 1px solid var(--line);
    border-radius: 14px;
    padding: 12px;
    margin-bottom: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,.04);
  }

  tbody td {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    padding: 6px 0;
    border: none;
  }

  /* ðŸ”‘ THIS IS THE IMPORTANT PART */
  tbody td::before {
    content: attr(data-label);
    color: #0f172a;      /* readable */
    font-weight: 700;   /* visible */
    font-size: 13px;
    opacity: 1;
  }

  tbody td input {
    width: 100%;
    max-width: 140px;
    text-align: right;
  }
}
</style>
</head>

<body>
<div class="wrap" id="app">

  <!-- HEADER -->
  <div class="card">
    <div class="row">
      <select id="month"></select>
      <select id="year"></select>
    </div>

    <div class="row" style="margin-top:10px;">
      <input id="startingBalance" type="number" placeholder="Starting balance" />
      <button id="lockBtn" class="secondary" type="button">ðŸ”“ Lock Month</button>
    </div>

    <div id="debug">Status: <strong>loadingâ€¦</strong></div>
  </div>

  <!-- REMAINING -->
  <div class="card sticky-remaining">
    <div class="kpi">
      <div>Remaining This Month</div>
      <div class="value" id="remaining">$0.00</div>
    </div>
  </div>

<div class="card" id="summary" style="font-size:14px;color:#475569;">
</div>


  <!-- INCOME -->
  <div class="card">
    <div class="section-header" onclick="toggleSection(this)">
  <h2>Income</h2>
  <span class="section-toggle">Hide</span>
</div>

    <table>
      <thead><tr><th>Source</th><th>Amount</th><th></th></tr></thead>
      <tbody id="income"></tbody>
    </table>
    <button id="addIncome" type="button">+ Add Income</button>
  </div>

  <!-- BILLS -->
  <div class="card">
    <div class="section-header" onclick="toggleSection(this)">
  <h2>Bills</h2>
  <span class="section-toggle">Hide</span>
</div>

    <table>
      <thead><tr><th>âœ”</th><th>Name</th><th>Amount</th><th></th></tr></thead>
      <tbody id="bills"></tbody>
    </table>
    <button id="addBill" type="button">+ Add Bill</button>
  </div>

  <!-- DEBT -->
  <div class="card">
    <div class="section-header" onclick="toggleSection(this)">
  <h2>Debt</h2>
  <span class="section-toggle">Hide</span>
</div>

    <table>
      <thead>
        <tr>
          <th>Debt</th><th>Balance</th><th>APR %</th><th>Payment</th><th>Extra</th>
          <th>Interest</th><th>Principal</th><th>New Balance</th><th></th>
        </tr>
      </thead>
      <tbody id="debt"></tbody>
    </table>
    <button id="addDebt" type="button">+ Add Debt</button>
  </div>

</div>

<script>
/* ========= STABLE CORE (Debug) ========= */

const $ = id => document.getElementById(id);
const money = n => `$${(Number(n)||0).toFixed(2)}`;

const app      = $("app");
const debugEl  = $("debug");

const monthSel = $("month");
const yearSel  = $("year");
const startBal = $("startingBalance");

const incomeT  = $("income");
const billsT   = $("bills");
const debtT    = $("debt");

const remaining = $("remaining");
const lockBtn   = $("lockBtn");

let locked = false;

function setDebug(msg){
  debugEl.innerHTML = `Status: <strong>${msg}</strong>`;
}

/* Month / Year */
(function initMonthYear(){
  const now = new Date();
  for(let i=0;i<12;i++){
    monthSel.add(new Option(new Date(0,i).toLocaleString("default",{month:"long"}), i));
  }
  for(let y=2024;y<2036;y++){
    yearSel.add(new Option(y, y));
  }
  monthSel.value = now.getMonth();
  yearSel.value  = now.getFullYear();
})();

function toggleSection(header){
  const card = header.closest(".card");
  const label = header.querySelector(".section-toggle");

  card.classList.toggle("collapsed");
  label.textContent = card.classList.contains("collapsed")
    ? "Show"
    : "Hide";
}


/* Row helper */
function addRow(table, cellsHtml){
  const tr = document.createElement("tr");
  tr.innerHTML = cellsHtml + `<td><span class="remove" title="Remove">Ã—</span></td>`;

  tr.querySelector(".remove").onclick = () => {
    if(locked) return;
    tr.remove();
    update();
  };

  tr.querySelectorAll("input, select").forEach(el => {
    el.addEventListener("input", update);
    el.addEventListener("change", update);
  });

  table.appendChild(tr);   // âœ… the key line
  update();
}

/* Buttons */
$("addIncome").addEventListener("click", () => {
  setDebug("Add Income clicked âœ…");
  if(locked) return;
  addRow(incomeT, `
  <td data-label="Source"><input></td>
  <td data-label="Amount"><input type="number" inputmode="decimal"></td>
`);

$("addBill").addEventListener("click", () => {
  setDebug("Add Bill clicked âœ…");
  if(locked) return;
  addRow(billsT, `
  <td data-label="Paid"><input type="checkbox"></td>
  <td data-label="Name"><input></td>
  <td data-label="Amount"><input type="number" inputmode="decimal"></td>
`);
});

$("addDebt").addEventListener("click", () => {
  setDebug("Add Debt clicked âœ…");
  if(locked) return;

  addRow(debtT,
    `<td data-label="Debt"><input></td>
     <td data-label="Balance"><input type="number" inputmode="decimal"></td>
     <td data-label="APR %"><input type="number" inputmode="decimal"></td>
     <td data-label="Payment"><input type="number" inputmode="decimal"></td>
     <td data-label="Extra"><input type="number" inputmode="decimal"></td>
     <td data-label="Interest">$0.00</td>
     <td data-label="Principal">$0.00</td>
     <td data-label="New Balance">$0.00</td>`
  );
});


/* Lock */
lockBtn.addEventListener("click", () => {
  locked = !locked;
  app.classList.toggle("locked", locked);
  lockBtn.textContent = locked ? "ðŸ”’ Unlock Month" : "ðŸ”“ Lock Month";
  save();
  setDebug(locked ? "Locked" : "Unlocked");
});

/* Calculate */
function sumIncome(){
  let t = 0;
  incomeT.querySelectorAll("tr").forEach(r=>{
    t += Number(r.children[1].querySelector("input")?.value) || 0;
  });
  return t;
}

function sumUnpaidBills(){
  let t = 0;
  billsT.querySelectorAll("tr").forEach(r=>{
    const paid = r.children[0].querySelector("input")?.checked;
    const amt  = Number(r.children[2].querySelector("input")?.value) || 0;
    if(!paid) t += amt;
    r.style.opacity = paid ? 0.45 : 1;
  });
  return t;
}

function calcDebtOut(){
  let total = 0;
  debtT.querySelectorAll("tr").forEach(r=>{
    const bal   = Number(r.children[1].querySelector("input")?.value) || 0;
    const apr   = Number(r.children[2].querySelector("input")?.value) || 0;
    const pay   = Number(r.children[3].querySelector("input")?.value) || 0;
    const extra = Number(r.children[4].querySelector("input")?.value) || 0;

    const interest  = bal * (apr/100/12);
    const principal = Math.max(pay - interest, 0) + extra;
    const newBal    = Math.max(bal - principal, 0);

    r.children[5].textContent = money(interest);
    r.children[6].textContent = money(principal);
    r.children[7].textContent = money(newBal);

    total += pay + extra;
  });
  return total;
}

function renderSummary(){
  const paidBills = [...billsT.querySelectorAll("tr")]
    .filter(r => r.children[0].querySelector("input").checked).length;

  const debtPaid = calculateDebt();
  const msg =
    paidBills > 0 || debtPaid > 0
      ? `You paid ${paidBills} bill${paidBills!==1?"s":""} and reduced debt by ${money(debtPaid)} this month.`
      : `No spending recorded yet.`;

  document.getElementById("summary").textContent = msg;
}
renderSummary();


function update(){
  const start  = Number(startBal.value) || 0;
  const income = sumIncome();
  const bills  = sumUnpaidBills();
  const debt   = calcDebtOut();
  remaining.textContent = money(start + income - bills - debt);
  save();
}

/* Save / Load (minimal + safe) */
function key(){
  return `stable-${yearSel.value}-${monthSel.value}`;
}

function save(){
  localStorage.setItem(key(), JSON.stringify({
    locked,
    start: startBal.value || "",
  }));
}

function load(){
  const d = JSON.parse(localStorage.getItem(key()) || "{}");

  locked = !!d.locked;
  app.classList.toggle("locked", locked);
  lockBtn.textContent = locked ? "ðŸ”’ Unlock Month" : "ðŸ”“ Lock Month";
  startBal.value = d.start || "";

  update();
  setDebug("JS running âœ… (loaded)");
}

monthSel.addEventListener("change", load);
yearSel.addEventListener("change", load);
startBal.addEventListener("input", update);

load();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Paycheck Tracker â€“ Planner Style v18</title>

<style>
body{
  background:#f4f5f7;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  margin:0;
}
.planner{max-width:1100px;margin:auto;padding:16px;}
.card{
  background:#fff;border-radius:14px;padding:16px;margin-bottom:18px;
  box-shadow:0 6px 20px rgba(0,0,0,.06);
}
.soft{background:#f8faf9;}
.heavy{border-left:6px solid #333;}
h2{margin:0 0 12px;}

.header{
  display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;
}

select,input{
  border:none;background:transparent;font-size:14px;
}
input:focus,select:focus{outline:none;}

table{width:100%;border-collapse:collapse;}
th,td{padding:8px;border-bottom:1px solid #eee;text-align:left;vertical-align:top;}

button{
  padding:6px 12px;border:none;border-radius:8px;
  background:#007aff;color:#fff;cursor:pointer;
}
button.secondary{background:#999;}
button:disabled{opacity:.55;cursor:not-allowed;}

.remove{cursor:pointer;font-size:18px;color:#999;}
.remove:hover{color:red;}

.total{text-align:right;font-weight:600;margin-top:8px;}

.remaining{display:flex;justify-content:space-between;align-items:center;}
.remaining strong{font-size:26px;}
.remaining.positive strong{color:green;}
.remaining.negative strong{color:red;}

.paid-row{opacity:.35;}
.overdue{background:#fff5f5;}
.due-today{background:#fffbea;}

.debt-meta{font-size:12px;color:#666;}
.time-killed{font-size:12px;color:#0a7a0a;}

.locked input,
.locked select,
.locked .remove,
.locked button.add-btn{
  pointer-events:none;
  opacity:.6;
}

.overview{
  display:grid;grid-template-columns:1fr auto;gap:10px 16px;
}
.positive{color:green;}
.negative{color:red;}

.lock-note{font-size:13px;color:#666;margin-top:8px;}
</style>
</head>

<body>
<div class="planner" id="appRoot">

<!-- HEADER -->
<section class="card header">
  <div>
    <select id="month"></select>
    <select id="year"></select>
  </div>
  <div>
    Starting Balance $
    <input type="number" id="startingBalance" value="0">
  </div>
  <div>
    <button id="lockBtn" class="secondary">ðŸ”“ Lock Month</button>
  </div>
</section>

<!-- REMAINING -->
<section class="card">
  <div class="remaining" id="remainingMeter">
    <span>Remaining This Month</span>
    <strong id="remainingAmount">$0.00</strong>
  </div>
  <div class="lock-note" id="lockNote"></div>
</section>

<!-- INCOME -->
<section class="card">
  <h2>Income</h2>
  <table id="incomeTable">
    <thead><tr><th>Date</th><th>Source</th><th>Amount</th><th></th></tr></thead>
    <tbody></tbody>
  </table>
  <button class="add-btn" onclick="addIncome()">+ Add Income</button>
  <div class="total">Total Income: $<span id="incomeTotal">0.00</span></div>
</section>

<!-- SAVINGS -->
<section class="card soft">
  <h2>Monthly Savings</h2>
  <table id="savingsTable">
    <thead><tr><th>Purpose</th><th>Amount</th><th></th></tr></thead>
    <tbody></tbody>
  </table>
  <button class="add-btn" onclick="addSavings()">+ Add Savings</button>
  <div class="total">Total Savings: $<span id="savingsTotal">0.00</span></div>
</section>

<!-- BILLS -->
<section class="card">
  <h2>Bills & Fixed Expenses</h2>
  <table id="billsTable">
    <thead>
      <tr>
        <th>âœ”</th>
        <th>Bill</th>
        <th>Due</th>
        <th>Amount</th>
        <th>Linked Debt</th>
        <th>Type</th>
        <th>Remaining</th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button class="add-btn" onclick="addBill()">+ Add Bill</button>
  <div class="total">Bills Remaining: $<span id="billsRemaining">0.00</span></div>
</section>

<!-- DEBT -->
<section class="card heavy">
  <h2>Debt</h2>
  <table id="debtTable">
    <thead>
      <tr>
        <th>Debt</th>
        <th>Balance</th>
        <th>APR %</th>
        <th>Payment</th>
        <th>Extra</th>
        <th>Interest</th>
        <th>Principal</th>
        <th>New Balance</th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button class="add-btn" onclick="addDebt()">+ Add Debt</button>
  <div class="total">Debt Outflow: $<span id="debtOutflow">0.00</span></div>
</section>

<!-- OVERVIEW -->
<section class="card">
  <h2>This Monthâ€™s Financial Overview</h2>
  <div class="overview">
    <div>Opening Balance</div><div id="oStart">$0.00</div>
    <div>Total Income</div><div id="oIncome">$0.00</div>
    <div>Bills</div><div id="oBills">$0.00</div>
    <div>Debt</div><div id="oDebt">$0.00</div>
    <div>Savings</div><div id="oSavings">$0.00</div>
    <div>Difference</div><div id="oDiff">$0.00</div>
    <div>Balance Forward</div><div id="oForward">$0.00</div>
  </div>
</section>

</div>

<script>
/* ================= SETUP ================= */
const monthSel=month, yearSel=year;
const now=new Date();
for(let i=0;i<12;i++) monthSel.innerHTML+=`<option value="${i}">${new Date(0,i).toLocaleString('default',{month:'long'})}</option>`;
for(let y=2024;y<2036;y++) yearSel.innerHTML+=`<option value="${y}">${y}</option>`;
monthSel.value=now.getMonth(); yearSel.value=now.getFullYear();

let locked=false;

/* ================= HELPERS ================= */
const num=v=>Number(v)||0;
const money=v=>`$${num(v).toFixed(2)}`;
function key(){return `planner-${yearSel.value}-${String(monthSel.value).padStart(2,"0")}`}

/* ================= ROW ADDERS ================= */
function addRemove(tr){
  const td=document.createElement("td");
  td.innerHTML=`<span class="remove">Ã—</span>`;
  td.onclick=()=>{tr.remove();updateAll(true)};
  tr.appendChild(td);
}

function addIncome(){
  const tr=document.createElement("tr");
  tr.innerHTML=`<td><input type="date"></td><td><input></td><td><input type="number" value="0"></td>`;
  addRemove(tr);
  tr.querySelectorAll("input").forEach(i=>i.oninput=()=>updateAll(true));
  incomeTable.tBodies[0].appendChild(tr);
}

function addSavings(){
  const tr=document.createElement("tr");
  tr.innerHTML=`<td><input></td><td><input type="number" value="0"></td>`;
  addRemove(tr);
  tr.querySelectorAll("input").forEach(i=>i.oninput=()=>updateAll(true));
  savingsTable.tBodies[0].appendChild(tr);
}

function addDebt(){
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td><input class="dname"></td>
    <td><input type="number" class="balance" value="0"></td>
    <td><input type="number" class="apr" value="0"></td>
    <td><input type="number" class="payment" value="0"></td>
    <td><input type="number" class="extra" value="0"></td>
    <td class="interest">$0.00</td>
    <td class="principal">$0.00</td>
    <td class="newbal">$0.00</td>`;
  addRemove(tr);
  tr.querySelectorAll("input").forEach(i=>i.oninput=()=>updateAll(true));
  debtTable.tBodies[0].appendChild(tr);
}

function addBill(){
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td><input type="checkbox" class="paid"></td>
    <td><input></td>
    <td><input type="date" class="due"></td>
    <td><input type="number" class="amount" value="0"></td>
    <td><select class="link"><option value="">â€”</option></select></td>
    <td>
      <select class="ptype">
        <option value="regular">Regular</option>
        <option value="principal">Extra Principal</option>
      </select>
    </td>
    <td class="remaining">$0.00</td>`;
  addRemove(tr);
  tr.querySelectorAll("input,select").forEach(i=>i.oninput=()=>updateAll(true));
  billsTable.tBodies[0].appendChild(tr);
}

/* ================= CORE LOGIC ================= */
function updateDebtLinks(){
  const names=[...debtTable.tBodies[0].rows].map(r=>r.querySelector(".dname").value);
  document.querySelectorAll(".link").forEach(sel=>{
    const cur=sel.value;
    sel.innerHTML=`<option value="">â€”</option>`+
      names.map(n=>`<option ${n===cur?"selected":""}>${n}</option>`).join("");
  });
}

function updateAll(save){
  updateDebtLinks();

  let income=0,savings=0,billsRemaining=0,debtOut=0;
  const today=new Date().toISOString().split("T")[0];

  [...incomeTable.tBodies[0].rows].forEach(r=>income+=num(r.children[2].querySelector("input").value));
  [...savingsTable.tBodies[0].rows].forEach(r=>savings+=num(r.children[1].querySelector("input").value));

  const debtMap={};
  [...debtTable.tBodies[0].rows].forEach(r=>{
    const name=r.querySelector(".dname").value;
    debtMap[name]=r;
  });

  [...billsTable.tBodies[0].rows].forEach(r=>{
    const paid=r.querySelector(".paid").checked;
    const amt=num(r.querySelector(".amount").value);
    const due=r.querySelector(".due").value;
    const link=r.querySelector(".link").value;
    const type=r.querySelector(".ptype").value;

    r.classList.toggle("paid-row",paid);
    r.classList.toggle("overdue",!paid&&due&&due<today);
    r.classList.toggle("due-today",!paid&&due===today);

    if(!paid) billsRemaining+=amt;
    r.querySelector(".remaining").textContent=paid?money(0):money(amt);

    if(paid && link && debtMap[link]){
      const d=debtMap[link];
      if(type==="principal"){
        d.querySelector(".extra").value =
          num(d.querySelector(".extra").value)+amt;
      }else{
        d.querySelector(".payment").value =
          num(d.querySelector(".payment").value)+amt;
      }
    }
  });

  [...debtTable.tBodies[0].rows].forEach(r=>{
    const bal=num(r.querySelector(".balance").value);
    const apr=num(r.querySelector(".apr").value);
    const pay=num(r.querySelector(".payment").value);
    const extra=num(r.querySelector(".extra").value);

    const interest=bal*(apr/100/12);
    const principal=Math.max(pay-interest,0)+extra;
    const newBal=Math.max(bal-principal,0);

    r.querySelector(".interest").textContent=money(interest);
    r.querySelector(".principal").textContent=money(principal);
    r.querySelector(".newbal").textContent=money(newBal);

    debtOut+=pay+extra;
  });

  incomeTotal.textContent=income.toFixed(2);
  savingsTotal.textContent=savings.toFixed(2);
  billsRemaining.textContent=billsRemaining.toFixed(2);
  debtOutflow.textContent=debtOut.toFixed(2);

  const start=num(startingBalance.value);
  const remaining=start+income-billsRemaining-debtOut-savings;
  remainingAmount.textContent=money(remaining);
  remainingMeter.className=`remaining ${remaining>=0?"positive":"negative"}`;

  oStart.textContent=money(start);
  oIncome.textContent=money(income);
  oBills.textContent=money(billsRemaining);
  oDebt.textContent=money(debtOut);
  oSavings.textContent=money(savings);
  oDiff.textContent=money(income-billsRemaining-debtOut);
  oForward.textContent=money(remaining);

  if(save){
    localStorage.setItem(key(),JSON.stringify({}));
  }
}

/* ================= LOCK ================= */
lockBtn.onclick=()=>{
  locked=!locked;
  appRoot.classList.toggle("locked",locked);
  lockBtn.textContent=locked?"ðŸ”’ Unlock":"ðŸ”“ Lock Month";
  lockNote.textContent=locked?"This month is locked to preserve history.":"";
};

startingBalance.oninput=()=>updateAll(true);
monthSel.onchange=yearSel.onchange=()=>location.reload();
</script>
</body>
</html>